<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../emotional-question/emotional-question.html">
    
<dom-module id="emotional-page">
    <link rel="import" type="css" href="emotional-page.css">
    <template>
        <paper-header-panel mode="seamed">
            <paper-toolbar>
                <div id="headerName">eSWYC <span>{{version}}</span> months</div>
            </paper-toolbar>
        </paper-header-panel>
        <div class="sName">Emotional Changes With A New Baby</div>
        <div id="emotionalQuestions">
        </div>
        <iron-ajax
            auto
            url="/questions.json"
            handle-as="json"
            on-response="handleResponse">
        </iron-ajax>
    </template>
    <script>
    var jsonOfQuestions ="";
    HTMLImports.whenReady(function () {
        Polymer({
            is: 'emotional-page',
            properties: {
                questions: {
                    type: Array,
                    notify: true,
                    value:[],
                    observer: '_createQuestions',
                },
                answers: {
                    type: Array,
                    notify: true,
                    value: [],
                },
                version: {
                    type: Number,
                    notify: true,
                    observer: 'pullQuestions',
				},
				answerOptions: {
                    type: Array,
                    notify: true,
                    value:[],
                },
                                
            },
        	listeners: {
        		'scoreChange': 'gatherScore',
      		},
            
            handleResponse: function (data) {
                jsonOfQuestions= data.detail.response;       
            },

            pullQuestions: function (data) {
               if (this.version){
                    this.questions = [];
                    var sectionName = "Emotional Changes With A New Baby";
                    var options = "Emotional Changes Answer Options";
                    swycAge=(String(this.version)).concat(" month");
                    this.answerOptions = jsonOfQuestions[swycAge]["questions"][options];
                    this.questions = jsonOfQuestions[swycAge]["questions"][sectionName];
                }         
            },
            _createQuestions: function(){
            	var questionContainer = this.$$("#emotionalQuestions");
            	questionContainer.innerHTML = "";
                for(var i = 0; i < this.questions.length; i++){
                    var newEmoQuestion = document.createElement("emotional-question");
                    newEmoQuestion.questionString = this.questions[i];
                    newEmoQuestion.options = this.answerOptions[i];
                    questionContainer.appendChild(newEmoQuestion);
                };
            },
            gatherScore: function(){
            	this.answers = []; //clear the answerArray
            	// use document.querySelecotorAll() to get the elements.
   				var answerList = 
   					Polymer.dom(this.root).querySelectorAll("emotional-question");   				 
    			for( var i = 0; i < answerList.length; i++ ){
    				// append answer from each questions to the answerArray
    				this.answers.push(answerList[i].score); 
    			};    			
    			//console.log(this.answers);
            },
        
        });
    });

    </script>
</dom-module>