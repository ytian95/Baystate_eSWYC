<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../family-question1/family-question1.html">
<link rel="import" href="../family-question2/family-question2.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
    
<dom-module id="family-page">
    <link rel="import" type="css" href="family-page.css">
    <template>
        <paper-header-panel mode="seamed">
            <paper-toolbar>
                <div id="headerName">eSWYC <span>{{version}}</span> months</div>
            </paper-toolbar>
        </paper-header-panel>
        <div class="sName">Family Question</div>
        <div class="optionSection">
            <div class="familyoption1">Yes</div>
            <div class="familyoption1">No</div>
            <div class="familyoption1">Skip Question</div>
        </div>
        <div id="familyQuestions1"></div>

        <div class="optionSection" id="section2">
            <div class="familyoption">Not at all</div>
            <div class="familyoption">Several days</div>
            <div class="familyoption">More than half the days</div>
            <div class="familyoption">Nearly everyday</div>
            <div class="familyoption">Skip Question</div>
        </div>
        <div id="familyQuestions2"></div>
        
        <div class="optionSection">
            <div class="familyoption">No tension</div>
            <div class="familyoption">Some tension</div>
            <div class="familyoption">A lot of tension</div>
            <div class="familyoption">Not applicable</div>
            <div class="familyoption">Skip Question</div>
        </div>
        <div id="familyQuestions3"></div>
        
        <iron-ajax
            auto
            url="/questions.json"
            handle-as="json"
            on-response="handleResponse">
        </iron-ajax>
    </template>
    <script>
        var jsonOfQuestions= "";
        HTMLImports.whenReady(function () {
            Polymer({
                is: 'family-page',
                properties: {
                    questions: {
                        type: Array,
                        notify: true,
                        value: [],
                        observer: '_createQuestions',
                    },
                	answers: {
                    	type: Array,
                    	notify: true,
                    	value: [[]],
                	},
                	version: {
                    	type: Number,
                    	notify: true,
                        observer: 'pullQuestions',
                	},
                },
                listeners: {
        			'scoreChange': 'gatherScore',
      			},
                handleResponse: function (data) {
                    jsonOfQuestions= data.detail.response   
                },

                pullQuestions: function (data) {
                    if (this.version){
                        this.questions = [];
                        swycAge=(String(this.version)).concat(" month");
                        console.log(swycAge);
                        this.questions = 
                        	jsonOfQuestions[swycAge]["questions"]["Family Questions"];
                    }         
                },
                _createQuestions: function(){            
                    var questionContainer1 = document.getElementById("familyQuestions1");
                    questionContainer1.innerHTML = "";
                    for(var i = 0; i < 5; i++){
                        var newFamilyQuestion = document.createElement("family-question1");
                        newFamilyQuestion.questionString = this.questions[i];
                        questionContainer1.appendChild(newFamilyQuestion);
                    };
                    
                    var questionContainer2 = document.getElementById("familyQuestions2");
                    var questionContainer3 = document.getElementById("familyQuestions3");
                    if (this.questions.length <= 7){
                    	for(var i = 5; i < this.questions.length; i++){
                        	var newFamilyQuestion = 
                        		document.createElement("family-question2");
                        	newFamilyQuestion.questionString = this.questions[i];
                        	questionContainer3.appendChild(newFamilyQuestion);
                        	questionContainer2.style.display = "none"; 
                        	this.$$("#section2").style.display = "none"
                        };                
                    }else {
                    	for(var i = 5; i < 7; i++){
                        	var newFamilyQuestion = 
                        		document.createElement("family-question2");
                        	newFamilyQuestion.questionString = this.questions[i];
                        	questionContainer2.appendChild(newFamilyQuestion);
                        };  
                    	for(var i = 7; i < this.questions.length; i++){
                        	var newFamilyQuestion = 
                        		document.createElement("family-question2");
                        	newFamilyQuestion.questionString = this.questions[i];
                        	questionContainer3.appendChild(newFamilyQuestion);
                        };                                  
                    };
                },
            	gatherScore: function(){
            		this.answers = []; //clear the answerArray
            		// use Polymer.dom(this.root).querySelecotorAll() to get the elements.
   					var answerList1 = 
   						Polymer.dom(this.root).querySelectorAll("family-question1");
   					var answerList2 =  
   						Polymer.dom(this.root).querySelectorAll("family-question2");
    				for( var i = 0; i < answerList1.length; i++ ){
    					// append answer from each questions to the answerArray
    					this.answers.push(answerList1[i].score); 
    				};   
    				for( var i = 0; i < answerList2.length; i++ ){
    					// append answer from each questions to the answerArray
    					this.answers.push(answerList2[i].score); 
    				};  			
           		},
        
            });
        });
    </script>
</dom-module>