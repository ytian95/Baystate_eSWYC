<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../bpsc-question/bpsc-question.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
    
<dom-module id="bpsc-page">
    <link rel="import" type="css" href="bpsc-page.css">
    <template>
        <paper-header-panel mode="seamed">
            <paper-toolbar>
                <div id="headerName">eSWYC <span>{{version}}</span> months</div>
            </paper-toolbar>
        </paper-header-panel>
        <div class="sName">Baby Pediatric Symptom Checklist</div>
        <div class="optionSection">
            <div class="dmoption">Not at all</div>
            <div class="dmoption">Somewhat</div>
            <div class="dmoption">Very Much</div>
            <div class="dmoption">Skip Question</div>
        </div>
        <div id="bpscQuestions"></div>
        <iron-ajax
            auto
            url="/questions.json"
            handle-as="json"
            on-response="handleResponse">
        </iron-ajax>
    </template>
    <script>
        var jsonOfQuestions= "";
        HTMLImports.whenReady(function () {
            Polymer({
                is: 'bpsc-page',
                properties: {
                    questions: {
                        type: Array,
                        notify: true,
                        value: [],
                        observer: '_createQuestions',
                    },
                	answers: {
                    	type: Array,
                    	notify: true,
                    	value: [],
                	},
                	version: {
                    	type: Number,
                    	notify: true,
                        observer: 'pullQuestions',
                	},
                },
                listeners: {
        			'scoreChange': 'gatherScore',
      			},
                handleResponse: function (data) {
                    jsonOfQuestions= data.detail.response   
                    console.log(jsonOfQuestions);     
                },

                pullQuestions: function (data) {
                    if (this.version){
                        this.questions = [];
                        swycAge=(String(this.version)).concat(" month");
                        console.log(swycAge);
                        if (this.version <= 15){
                            this.questions= jsonOfQuestions[swycAge]["questions"]["BPSC"];
                        }else{
                            this.questions= jsonOfQuestions[swycAge]["questions"]["PPSC"];
                        }
                        //console.log(swycAge);
                    }         
                },
                _createQuestions: function(){
                    var questionContainer = document.getElementById("bpscQuestions");
                    for(var i = 0; i < this.questions.length; i++){
                        var newDevQuestion = document.createElement("bpsc-question");
                        newDevQuestion.questionString = this.questions[i];
                        questionContainer.appendChild(newDevQuestion);
                    };
                },
            	gatherScore: function(){
            		this.answers = []; //clear the answerArray
            		// use document.querySelecotorAll() to get the elements.
   					var answerList = document.querySelectorAll("bpsc-question"); 
    				for( var i = 0; i < answerList.length; i++ ){
    					// append answer from each questions to the answerArray
    					this.answers.push(answerList[i].score); 
    				};    			
           		},
        
            });
        });
    </script>
</dom-module>